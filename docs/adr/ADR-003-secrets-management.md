# ADR-003: Управление секретами
Дата: 2025-10-16
Статус: Accepted

## Context
Для работы в реальных окружениях (staging, production) приложению потребуются секреты: строка подключения к БД, секретный ключ для подписи JWT, ключи к внешним API. Хранение секретов в коде или в системе контроля версий является критической уязвимостью.

## Decision
Мы принимаем следующую стратегию управления секретами:
1.  **Запрет на хранение в коде:** Секреты **никогда** не должны быть захардкожены в исходном коде.
2.  **Локальная разработка:** Секреты передаются в приложение через **переменные окружения**, управляемые с помощью файла `.env`. Этот файл должен быть добавлен в `.gitignore`.
3.  **Production-окружение:** Секреты должны управляться через специализированное хранилище (например, HashiCorp Vault, AWS Secrets Manager, GCP Secret Manager) и передаваться в приложение во время развертывания (например, как переменные окружения в Kubernetes).

Приложение будет читать конфигурацию из переменных окружения при старте.

## Alternatives
1.  **Хранение секретов в файле конфигурации (не в Git):** Улучшает отделимость, но усложняет развертывание и ротацию секретов.
2.  **Использование шифрованных файлов в Git (например, Ansible Vault):** Требует управления ключами для расшифровки, что просто переносит проблему на уровень выше.

## Consequences
- **Плюсы:**
    - Максимальный уровень безопасности: исходный код не содержит секретов.
    - Соответствие принципам 12-Factor App.
    - Упрощается ротация секретов без необходимости пересборки приложения.
- **Минусы:**
    - Усложняет процесс развертывания и настройки окружения.
    - Требует дополнительной инфраструктуры для хранения секретов в production.

## Links
- **NFR:** Концептуально связано с `NFR-01`, `NFR-06`
- **Риск:** Снижает риск полной компрометации системы при утечке исходного кода.
