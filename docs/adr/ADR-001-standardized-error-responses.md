# ADR-001: Стандартизация формата ошибок
Дата: 2025-10-16
Статус: Accepted

## Context
Текущая реализация API возвращает ошибки в собственном, нестандартном формате (`{"error": {"code": ..., "message": ...}}`). Это усложняет автоматическую обработку ошибок на стороне клиента (например, фронтенда) и может привести к утечке отладочной информации (stack traces) при неправильной обработке исключений. Необходимо выбрать единый, стандартный формат для всех ошибок, возвращаемых API.

## Decision
Мы принимаем решение использовать стандарт **RFC 7807 (Problem Details for HTTP APIs)** для всех ответов с кодом ошибки (4xx и 5xx).

Каждый ответ об ошибке будет содержать JSON-объект со следующими полями:
- `type`: URI, идентифицирующий тип проблемы (может быть `about:blank`).
- `title`: Краткое, читаемое описание проблемы.
- `status`: HTTP-статус код.
- `detail`: Более подробное описание конкретного случая ошибки.
- `correlation_id`: Уникальный идентификатор запроса для упрощения отладки и связи логов.

## Alternatives
1.  **Оставить текущий формат:** Просто, но не соответствует индустриальным практикам и усложняет интеграцию.
2.  **Использовать формат JSON:API:** Другой стандарт, но он более сложен и избыточен для нашего простого CRUD-сервиса.
3.  **Простой текстовый ответ:** Плохая практика, не подходит для API.

## Consequences
- **Плюсы:**
    - Клиенты могут надежно и единообразно обрабатывать ошибки.
    - Упрощается отладка благодаря `correlation_id`.
    - Снижается риск утечки чувствительной информации, так как формат строго определен.
- **Минусы:**
    - Требуется рефакторинг существующих обработчиков исключений.
    - Небольшое увеличение размера ответа об ошибке.

## Links
- **NFR:** `NFR-08` (Структурированное логирование)
- **Риск:** `R8` (Раскрытие технических деталей в ошибках)
- **Тесты:** `tests/test_errors.py` (будет дополнено)
