# ADR-002: Защита от брутфорс-атак (Rate Limiting)
Дата: 2025-10-16
Статус: Accepted

## Context
API-эндпоинты, особенно те, что создают ресурсы (`POST /retros`) или в будущем будут отвечать за аутентификацию (`POST /login`), уязвимы к атакам типа "отказ в обслуживании" (DoS) и перебору паролей (brute-force). Отсутствие ограничений на частоту запросов создает высокий риск (`R1`, `R4`).

## Decision
Мы внедряем механизм **Rate Limiting** на уровне приложения с помощью библиотеки `slowapi`.

- **Стратегия:** Token Bucket.
- **Хранилище лимитов:** In-memory (для простоты, в production можно использовать Redis).
- **Ключ:** IP-адрес клиента.
- **Политика по умолчанию:** **20 запросов в минуту** на все "чувствительные" эндпоинты, изменяющие данные (`POST`, `PUT`, `DELETE`).

При превышении лимита сервер будет возвращать ошибку `429 Too Many Requests`.

## Alternatives
1.  **Реализация на уровне инфраструктуры (Nginx, API Gateway):** Эффективно, но выносит логику за пределы приложения и усложняет тонкую настройку для разных эндпоинтов.
2.  **Написать собственный middleware:** "Изобретение велосипеда", что может привести к ошибкам в реализации безопасности.
3.  **Не внедрять:** Неприемлемо с точки зрения безопасности и стабильности сервиса.

## Consequences
- **Плюсы:**
    - Значительно снижает риски DoS и брутфорс-атак.
    - Повышает общую стабильность и предсказуемость работы сервиса.
- **Минусы:**
    - Добавляет новую зависимость (`slowapi`).
    - Может случайно заблокировать легитимных пользователей с необычной активностью (требует тонкой настройки лимитов).
    - Небольшое увеличение задержки на каждый запрос для проверки лимита.

## Links
- **NFR:** `NFR-07` (Ограничение частоты запросов)
- **Риски:** `R1` (Брутфорс логина), `R4` (Отказ в обслуживании)
- **Тесты:** `tests/test_rate_limiter.py` (будет создано)
